<!doctype html>
<html lang="en">

<head>
  <meta name="ahrefs-site-verification" content="f9805fd529e993ad2b1929b09f27c0b69fbda9fad04acead603f2847527f3b52">
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <style>
    .ads {
        text-align: center;
    }
  </style>
  <title>Spotify Bubble Chart</title>
  <meta name="description" content="Spotify Bubble Chart">
  
  <meta name="robots" content="index, follow">
  
  <meta property="og:title" content="Spotify Bubble Chart">
<meta property="og:description" content="Spotify Bubble Chart">
<meta property="og:image" content="https://huangdarren1106.github.io/Pda1RiEozzCSnLTJfZqvYgUqvzDJRx1t70d0cDIq.jpg">
<meta property="og:url" content="https://huangdarren1106.github.io/spotify-bubble-chart">
<meta property="og:site_name" content="Spotify Pie - Exploring Your Spotify Stats in a Fun Way">
<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<link rel="canonical" href="https://huangdarren1106.github.io/spotify-bubble-chart">

  <meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Spotify Bubble Chart">
<meta name="twitter:description" content="Spotify Bubble Chart">
<meta name="twitter:image" content="https://huangdarren1106.github.io/Pda1RiEozzCSnLTJfZqvYgUqvzDJRx1t70d0cDIq.jpg">
<meta name="twitter:image:alt" content="Spotify Bubble Chart">
  
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  

  <script defer data-domain="huangdarren1106.github.io" src="https://stats.senty.com.au/js/script.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3723218062742398"
        crossorigin="anonymous"></script>
  <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
  <script>
    window.googletag = window.googletag || {};
    googletag.cmd = googletag.cmd || [];
    googletag.cmd.push(function () {
      if (window.innerWidth >= 1024) {
        googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_1000x100_desktop_anchor', [[1000, 100], [970, 90], [728, 90], [990, 90], [970, 50], [960, 90], [950, 90], [980, 90]], 'huangdarren1106_github_io_anchor_ad_responsive').addService(googletag.pubads());
      } else {
        googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_320x100_mobile_anchor', [[320, 100], [320, 50], [300, 100], [300, 50]], 'huangdarren1106_github_io_anchor_ad_responsive').addService(googletag.pubads());
      }
      var interstitialSlot = googletag.defineOutOfPageSlot('/147246189,22921845643/huangdarren1106.github.io_interstitial', googletag.enums.OutOfPageFormat.INTERSTITIAL);
      if (interstitialSlot) interstitialSlot.addService(googletag.pubads());

      googletag.pubads().enableSingleRequest();
      googletag.pubads().disableInitialLoad();
      googletag.pubads().collapseEmptyDivs();
      googletag.enableServices();
      googletag.display(interstitialSlot);
    });
  </script>
<script async src="https://stpd.cloud/saas/6406"></script>
  
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  
  <meta name="google-site-verification" content="0I5jWqQYG7ahDKO-xLIJWViQ8SPeE0SgnfbaXjFInkU" />
  
    
  <link rel="modulepreload" href="https://huangdarren1106.github.io/build/assets/app-w40geAFS.js" /><link rel="modulepreload" href="https://huangdarren1106.github.io/build/assets/app-ARot55nG.js" /><script type="module" src="https://huangdarren1106.github.io/build/assets/app-w40geAFS.js"></script><script type="module" src="https://huangdarren1106.github.io/build/assets/app-ARot55nG.js"></script>      <script src="https://cdn.jsdelivr.net/npm/d3@6"></script>
  </head>

<body>
  <header class="max-w-3xl mx-auto">
  <div class="flex flex-col sm:flex-row justify-between items-center py-4 px-4 sm:px-0 border-b">
    <a href="/" class="flex items-center gap-2 sm:text-2xl font-bold mb-4 sm:mb-0 whitespace-nowrap">
      <img class="w-8 inline-block" src="/spotify-pie.png" alt="Spotify Pie">
      Spotify Pie
    </a>
    <div class="flex justify-center sm:justify-end w-full gap-4 flex-wrap">
      <a title="Spotify Stats" href="/spotify-stats" class="relative bg-gray-100 px-2 py-1 rounded-lg">Spotify Stats</a>
      <a title="Spotify Feed" href="/feed" class="relative bg-gray-100 px-2 py-1 rounded-lg">
        Spotify Feed
      </a>
      <a title="Top Songs" href="/spotify-top-songs-right-now" class="relative bg-gray-100 px-2 py-1 rounded-lg">
        Top Songs
        <span class="absolute -top-1 -right-2 text-xs text-white bg-red-600  animate-pulse rounded-full px-1">New</span>
      </a>
      <a title="Subscribe" href="/subscribe" class="relative bg-gray-100 px-2 py-1 rounded-lg">Subscribe</a>
    </div>
  </div>
</header>
  
  <div class="mx-auto max-w-3xl prose prose-lg pt-8 px-4 lg:px-0">
        <h1 class="text-3xl sm:text-5xl text-center text-green-600">Spotify Bubble Chart</h1>
    
          <div x-data="bubblechart">
  
  <div x-show="!token"
       class="text-center w-full border bg-green-50 rounded-lg p-4 border-green-600 mb-4 flex flex-col items-center">
      <p class="text-lg text-green-800 font-semibold mb-2">
        Visit Login page
      </p>
      <img class="w-24 my-4 motion-safe:animate-spin" src="/spotify-pie.png" alt="Spotify Pie">
      <a href="/" class="px-6 py-3 bg-green-600 text-white text-xl rounded-full font-bold">Login</a>
    </div>

    <div class="max-w-sm mx-auto">
      <div class="flex justify-center text-sm mb-4 w-full border rounded-full text-center shadow-lg">
        <a href="/spotify-pie" :class="{'bg-purple-600 text-white': isSpotifyPie}"
           class="flex-1 py-2 px-2 rounded-l-full no-underline flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
            <path fill="#ba9aea" d="M12 12V2c5.523 0 10 4.477 10 10H12z" opacity=".25" />
            <path fill="#ba9aea" d="m12 12l5 8.66A10.01 10.01 0 0 0 22 12H12z" opacity=".5" />
            <path fill="#ba9aea"
                  d="M17 20.66L12 12V2c-5.523.002-9.999 4.48-9.997 10.003c.002 5.523 4.48 9.999 10.004 9.997A10 10 0 0 0 17 20.662l.003-.005l-.004.003z" />
          </svg>
          Spotify Pie</a>
        <a href="/spotify-bubble-chart" :class="{'bg-purple-600 text-white': isSpotifyBubble}"
           class="flex-1 py-2 no-underline flex items-center justify-center px-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 48 48">
            <defs>
              <mask id="ipTBubbleChart0">
                <g fill="#555" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="4">
                  <circle cx="34" cy="14" r="9" />
                  <circle cx="12" cy="25" r="7" />
                  <circle cx="29" cy="37" r="5" />
                </g>
              </mask>
            </defs>
            <path fill="#ba9aea" d="M0 0h48v48H0z" mask="url(#ipTBubbleChart0)" />
          </svg>
          Spotify Bubble</a>
        <a href="/spotify-stats" :class="{'bg-purple-600 text-white': isSpotifyStats}"
           class="flex-1 rounded-r-full py-2 px-2 no-underline flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
            <path fill="none" stroke="#ba9aea" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 16.5h2v.5H3zm5 0h2.5v.5H8zm8 .5h-2.5v-.5H16zm5.5 0H19v-.5h2.5zm0-4H19v.5h2.5zm0-3.5H19v.5h2.5zm0-3.5H19v.5h2.5zM16 13h-2.5v.5H16zm-8 .5h2.5V13H8zm0-4h2.5v.5H8z" />
          </svg>
          Spotify Stats</a>
      </div>
    </div>

    <div x-show="token" class="shadow-lg mb-4 border rounded-lg max-w-sm mx-auto bg-neutral-50">
      <div id="bubble-chart" class="p-4">
        <div class="flex justify-center">
          <div id="chart" @click="resetPosition()"></div>
        </div>
      </div>
    </div>
    <p x-show="token && !isStopped" class="max-w-sm mx-auto text-center font-semibold">Click to stop bubbles</p>
    <p x-show="token && isStopped" class="max-w-sm mx-auto text-center font-semibold">Click again to bubble up!</p>
    <p x-show="token" class="max-w-sm mx-auto text-center font-semibold">Don't forget to share it!</p>

  <div class="mb-4 max-w-3xl mx-auto">
    <script type="text/javascript" src="https://video.onnetwork.tv/widget/widget_scrolllist.php?widget=1385"></script>
</div>
  
    
  </div>
        
    
  </div>
  
  <div class="flex pb-16 flex-col items-center gap-4 prose my-8 mx-auto max-w-3xl text-sm justify-center px-4 sm:px-0">
  <a href="/">Spotify Pie Chart</a>
  <a href="/spotify-stats">Spotify Stats</a>
  <a href="/receiptify">Receiptify</a>
  <a href="/trackify">Trackify - Your Spotify Listening Statistics</a>
  <a href="/playlist-name-generator">Playlist Name Generator</a>
  <a href="/generation-names">Generation Names and Years in Order</a>
  <a href="/spotify-banner-size">Spotify Banner Size 2024</a>
  <a href="/spotify-wrapped">Spotify Wrapped 2024</a>
  <a href="/spotify-top-songs-right-now">Top Songs</a>
  <a href="/subscribe">Subscribe to New Spotify Pie</a>
</div>
  
  <div id="huangdarren1106_github_io_anchor_ad_responsive" class="ads">
  <script>
    googletag.cmd.push(function () {
      googletag.display('huangdarren1106_github_io_anchor_ad_responsive');
    });
  </script>
</div>
      <script>
      document.addEventListener('alpine:init', () => {
        Alpine.data('bubblechart', () => ({
          show: false,
          token: null,
          profile: null,
          time_range: 'short_term',
          top_artists: [],
          isSpotifyBubble: true,
          isSpotifyStats: false,
          isSpotifyPie: false,
          genresChartData: [],
          resetPosition: null,
          capture() {
            html2canvas(document.querySelector("#bubble-chart", {
              backgroundColor: "none",
              useCORS: true,
              logging: true,
              letterRendering: 1,
              allowTaint: false
            })).then(canvas => {
              var link = document.createElement('a');
              link.download = 'spotify-bubble-chart.png';
              link.href = canvas.toDataURL('image/png')
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);

            });

          },
          setActiveTab(tab) {
            // fetch data depends on activeTab
            if (tab === 'top_tracks') {
              this.getTopTracks(this.time_range);
            } else {
              this.getTopArtists(this.time_range);
            }
          },

          async getProfile() {
            fetch('https://api.spotify.com/v1/me', {
              headers: {
                'Authorization': 'Bearer ' + this.token
              }
            }).then(response => {
              if (response.status === 401) {
                throw new Error('token expired');
              } else {
                return response.json();
              }
            }).then(data => {
              this.profile = data;

            }).catch(e => {
              console.log(e);
              this.reset()
            });
          },
          getTopArtists(time_range) {
            fetch(`https://api.spotify.com/v1/me/top/artists?limit=10&time_range=${time_range}`, {
              headers: {
                'Authorization': 'Bearer ' + this.token
              }
            })
              .then(response => {
                if (response.status === 401) {
                  throw new Error('token expired');
                } else {
                  return response.json();
                }

              })
              .then(data => {
                this.top_artists = data;

                this.genresChartData = [];
                const genres = {};
                this.top_artists.items.forEach(artist => {
                  artist.genres.forEach(genre => {
                    if (genres[genre]) {
                      genres[genre] += 1;
                    } else {
                      genres[genre] = 1;
                    }
                  })
                });
                Object.keys(genres).forEach(genre => {
                  this.genresChartData.push({
                    name: genre,
                    value: genres[genre] * 4 + 8
                  })
                });
                // sort by value
                this.genresChartData.sort((a, b) => b.value - a.value);
                // filter top 10
                this.genresChartData = this.genresChartData.slice(0, 10);

                // sum of top 10 genres
                const sum = this.genresChartData.reduce((a, b) => a + b.value, 0);

                // create a new data array
                let d = [
                  ...this.top_artists.items.map((artist, i) => {
                    return {
                      name: artist.name,
                      value: 11 - (i + 1),
                      img: artist.images[0].url
                    }
                  })];
                // merge data

                // sort by value
                d.sort((a, b) => b.value - a.value);


                let svg = this.createChartSVG(d, 340, 320)


                document.getElementById('chart').innerHTML = svg.outerHTML;
                this.animateBubbles(d3.selectAll(".node"), 340, 320);


              }).catch(e => {
              console.log(e);
            });
          },
          reset() {
            this.token = null;
            localStorage.removeItem('token');
          },

          createChartSVG(data, width, height) {
            // Create an SVG element using D3
            var svg = d3.create("svg")
              .attr("width", width)
              .attr("height", height)
              .attr("xmlns", "http://www.w3.org/2000/svg")
              .attr("style", "max-width: 100%; height: auto; font: 12px sans-serif;");

            // Define a scale for the font size
            var fontSizeScale = d3.scaleSqrt()
              .domain([d3.min(data, d => d.value), d3.max(data, d => d.value)])
              .range([6, 14]); // Adjust the range based on your preference

            // Define a color scale for text for better contrast
            var textColor = d3.scaleOrdinal(["white", "black"]);
            // Define a color scale
            var color = d3.scaleOrdinal(d3.schemeCategory10);

            // Create a bubble layout with the specified dimensions
            var bubble = d3.pack()
              .size([width, height])
              .padding(1.5);

            var nodes = d3.hierarchy({ children: data })
              .sum(function (d) { return d.value; });

            // Create the nodes for each bubble
            var node = svg.selectAll(".node")
              .data(bubble(nodes).leaves())
              .enter().append("g")
              .attr("class", "node")
              .attr("transform", function (d) { return "translate(" + d.x + "," + d.y + ")"; });

            // Create the elements for each node
            node.each(function (d) {
              var node = d3.select(this);

              if (d.data.img) {
                // Define a clipping path for the image
                var clipId = "clip-" + d.data.name.replace(/\s+/g, '-'); // Create a unique clip ID
                svg.append("clipPath")
                  .attr("id", clipId)
                  .append("circle")
                  .attr("r", d.r)
                  .attr("cx", 0)
                  .attr("cy", 0);

                // Append an image and apply the clipping path
                node.append("image")
                  .attr("xlink:href", d.data.img)
                  .attr("width", d.r * 2)
                  .attr("height", d.r * 2)
                  .attr("x", -d.r)
                  .attr("y", -d.r)
                  .attr("clip-path", "url(#" + clipId + ")") // Apply clipping path
                  .style("object-fit", "cover"); // Make the image cover the node

                // Append a circle overlay as a border
                node.append("circle")
                  .attr("r", d.r)
                  .attr("stroke", "gray") // Set border color
                  .attr("stroke-width", 1) // Set border width
                  .attr("fill", "none"); // Ensure the circle is only a border without fill
              } else {
                // If the node is a genre, append a circle

                node.append("circle")
                  .attr("r", d.r)
                  .attr("fill", function (d, i) { return color(d.data.name); }); // Use the name as the color identifier
                // Append text for genres
                node.append("text")
                  .attr("dy", ".3em")
                  .style("text-anchor", "middle")
                  .style("fill", function (d, i) { return textColor(i % 2); })
                  .style("font-size", function (d) { return `${fontSizeScale(d.data.value)}px`; })
                  .text(function (d) { return d.data.name; });
              }
            });

            // Return the SVG node
            return svg.node();
          },
          interval:null,
          isStopped: false,
          animateBubbles(node, width, height) {

            var initialPositions = [];

            node.each(function (d) {
              var position = d3.select(this).attr("transform").match(/translate\(([^,]+),([^,]+)\)/);
              var x = parseFloat(position[1]);
              var y = parseFloat(position[2]);
              initialPositions.push({ x: x, y: y });
            });

            function resetPositions() {
              if(this.isStopped){
                this.interval = setInterval(updatePositions, 100);
                this.isStopped = false
              } else {
                clearInterval(this.interval);
                this.isStopped = true
                node.transition()
                  .duration(1000) // Duration of the movement, in milliseconds
                  .attr("transform", function (d, i) {
                    return "translate(" + initialPositions[i].x + "," + initialPositions[i].y + ")";
                  });
              }

            }

            function updatePositions() {
              node.transition()
                .duration(1000) // Duration of the movement, in milliseconds
                .attr("transform", function (d, i) {
                  // Generate new random positions within the SVG bounds
                  var newX = parseFloat(d3.select(this).attr("transform").match(/translate\(([^,]+),([^,]+)\)/)[1]);
                  // make newX randomly increase or decrease
                  newX += Math.random() * 100 > 50 ? 30 : -30;
                  var newY = Math.random() * (height - 310);
                  return "translate(" + newX + "," + newY + ")";
                });
            }

            // Update the positions every 100 milliseconds

            this.resetPosition = resetPositions;


            this.interval = setInterval(updatePositions, 100); // Interval between movements, in milliseconds
          },

          async init() {
            // read token from local storage
            this.token = localStorage.getItem('token');
            console.log(this.token)
            if (this.token) {
              try {
                await this.getTopArtists(this.time_range)
                await this.getProfile()
              } catch (e) {
                console.log(e);
              }

            }
          }
        }));
      });
    </script>
  </body>

</html>
